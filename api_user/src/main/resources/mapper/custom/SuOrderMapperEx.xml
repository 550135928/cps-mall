<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xm.api_user.mapper.custom.SuOrderMapperEx" >



    <select id="getUserOrderAbout" resultType="java.util.HashMap">
        SELECT IFNULL(SUM(o.quantity * (o.original_price - o.amount)),0) totalCoupon, IFNULL(SUM(o.quantity *  o.amount),0) totalConsumption FROM su_order o WHERE o.user_id = #{userId}
    </select>

    <select id="getUserTotalCommission" resultType="java.math.BigDecimal">
        SELECT
            IFNULL(SUM(sb.money),0)
        FROM
            su_bill sb
        <where>
            AND sb.user_id = #{userId}
            AND sb.type in (2,4)
            <if test="state != null">
                AND sb.state = #{state}
            </if>
            <if test="startTime != null">
                <![CDATA[ AND sb.create_time > #{startTime} ]]>
            </if>
            <if test="endTime != null">
                <![CDATA[ AND sb.create_time < #{endTime} ]]>
            </if>
            AND income = 1
        </where>
    </select>

    <select id="getUserTotalConsumption" resultType="java.math.BigDecimal">
        SELECT IFNULL(SUM(o.quantity * (o.original_price - o.amount)),0) FROM su_order o WHERE o.user_id = #{userId}
    </select>


    <select id="getUserShareOrderAbout" resultType="java.math.BigDecimal">
        SELECT IFNULL(SUM(o.quantity *  o.amount),0) totalShare FROM su_order o WHERE o.share_user_id = #{userId}
    </select>


</mapper>
